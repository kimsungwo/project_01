package com.teamcoffee.buy.controller;

import javax.annotation.Resource;
import javax.servlet.http.HttpSession;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import com.teamcoffee.buy.service.BuyService;
import com.teamcoffee.buy.vo.BuyVO;
import com.teamcoffee.cart.service.CartService;
import com.teamcoffee.cart.vo.CartVO;
import com.teamcoffee.member.vo.MemberVO;

@Controller
@RequestMapping("/buy")
public class BuyController {
	@Resource(name = "buyService")
	private BuyService buyService;
	
	@Resource(name = "cartService")
	private CartService cartService;
	
	//바로 주문
	@GetMapping("/buyConfirm")
	public String buyConfirm(CartVO cartVO, Model model, HttpSession session) {
		MemberVO member = (MemberVO)session.getAttribute("memberLoginInfo");
		cartVO.setMemCode(member.getMemCode());
		model.addAttribute("cartList", cartService.selectCartList(cartVO));
		model.addAttribute("memberInfo", buyService.selectBuyerInfo(member));
		model.addAttribute("cartSize", buyService.selectCartCodeSize(member));
		return "buy/buy_confirm";
	}
	
	//구매 테이블에 insert
	@ResponseBody
	@PostMapping("/insertBuyList")
	public int insertBuyList(BuyVO buyVO, HttpSession session) {
		MemberVO member = (MemberVO)session.getAttribute("memberLoginInfo");
		buyVO.setMemCode(member.getMemCode());
		return buyService.insertBuyList(buyVO);
	}
	
	//결제 완료 후 이동 페이지
	@GetMapping("/buyComplete")
	public String buyComplete() {
		return "buy/buy_complete";
	}
	
}
